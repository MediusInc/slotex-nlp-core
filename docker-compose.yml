version: "3.2"
services:
  # broker
  redis:
    image: redis:${REDIS_TAG}
    sysctls:
      net.core.somaxconn: 1024
    restart: always  
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - ./docker/data/redis:/data/:rw
    networks:
      - slotex-nlp-network
  # mongodb
  mongodb:
    image: mongo:${MONGO_TAG}
    restart: always  
    container_name: mongodb
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=admin
      - MONGO_DATABASE=slotex_nlp
      - MONGO_PASSWORD=toor123
      - MONGO_USERNAME=admin
    ports:
      - "27017:27017"
    volumes:
      - ./docker/data/mongo:/data/db:rw
      - ./docker/mongodb/scripts/:/docker-entrypoint-initdb.d/:rw
    networks:
      - slotex-nlp-network
  # NLP
  slotex-nlp-core:
    image: mediussi/slotex-nlp-core:${SLOTEX_NLP_CORE_TAG}
    restart: always
    container_name: slotex-nlp-core
    ports:
      - "8100:8100"
    environment:
      - SLOTEX_NLP_SERVICE="http://localhost:8100"
      - MONGODB_AUTHENTICATION=slotex_nlp
      - MONGODB_USERNAME=admin
      - MONGODB_PASSWORD=toor123
      - MONGODB_DATABASE=slotex_nlp
      - MONGODB_PORT=22017
      - MONGODB_HOST=mongodb
      - REDIS_HOST=redis
      - REDIS_PORT=6379
    volumes:
      - ./docker/application.properties.tmpl:/conf/application.properties.tmpl:ro
      - ./docker/data/slotex-nlp:/var/data:rw
    networks:
      - slotex-nlp-network
    depends_on:
      - redis
      - mongodb
    links:
      - redis
      - mongodb
# volumes
volumes:
  mongodb_data:
  redis_data:
  mediusnlp_data:
# networks
networks:
  slotex-nlp-network:
    driver: bridge
